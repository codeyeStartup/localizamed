<!DOCTYPE HTML>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
        integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/notyf@3.7.0/notyf.min.css">

    <title>Redefinir Senha</title>

    <!-- JQuery -->
    <script src="http://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/notyf@3.7.0/notyf.min.js"></script>

    <script>
        $(document).ready(function () {

            document.getElementById("btn-confirmar").addEventListener("click", function (event) {
                const notyf = new Notyf();
                var formData = new FormData();
                var senha = document.dados.senha.value;
                var confirmaSenha = document.dados.confirmaSenha.value;                    
                
                formData.append("senha", senha);
                formData.append("confirmaSenha", confirmaSenha)
                
                // criar xmlhttprequest
                var xhr = new XMLHttpRequest();

                var urlString = window.location.href;
                var url = new URL(urlString);
                var email = url.searchParams.get("email");
                
                if (senha.length < 6 || confirmaSenha.length < 6) {
                    event.preventDefault();
                    return notyf.error('A senha deve conter no mínimo 6 dígitos.')
                }
                if (senha != confirmaSenha) {
                    event.preventDefault();
                    return notyf.error('As senhas não são equivalentes. Tente novamente.')
                }

                if (senha == confirmaSenha) {
                    xhr.open("PUT", `${url.origin}/update_pass/${email}`);
                    console.log(url)
                    xhr.send(formData);
                    // document.dados.action = 'update_pass_confirm.html';
                    notyf.success('Senha atualizada com sucesso!')
                }
            });
        });
    </script>

</head>

<body>
    <noscript>
        <p style="text-align: center;">&Eacute; necess&aacute;rio o javascript habilitado para visualizar esta
            p&aacute;gina.</p>
    </noscript>

    <div class="container" id="container_form">
        <div class="row d-flex justify-content-center">
            <div class="col-md-8 col-xs-12 col-sm-12 col-lg-6">
                <div class="card mt-5 card-form">
                    <div class="img-header d-flex justify-content-center">
                        <img src="img/logo.PNG" class="card-img-top w-50" alt="...">
                    </div>
                    <div class="card-body">
                        <h5 class="card-title text-center">Alterar senha</h5>
                        <div class="w-100">
                            <form name="dados" action="/update_pass_get/update" method="POST">
                                <div class="form-group">
                                    <label class="w-100">
                                        <span class="label">Nova Senha</span>

                                        <input type="password" name="senha" id="senha" class="form-control"
                                            required="required" placeholder="&nbsp;" autocomplete="off">
                                    </label>
                                </div>


                                <div class="form-group">
                                    <label class="w-100">
                                        <span class="label">Confirmar nova Senha</span>
                                        <input type="password" name="confirmaSenha" id="confirmaSenha"
                                            class="form-control" required="required" placeholder="&nbsp;"
                                            autocomplete="off">
                                    </label>
                                </div>

                                <div class="form-group d-flex justify-content-center">
                                    <button class="btn btn-success" id="btn-confirmar" type="submit">Confirmar</button>
                                </div>

                                <div class="error-message">

                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>